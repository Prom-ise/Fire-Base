<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <input type="number" id="phoneNumberInput" />
    <input type="number" id="codeInput" />
    <button onclick="signP()">Sign In with Phone Number</button>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
      import { getAuth, RecaptchaVerifier, signInWithPhoneNumber,
      } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyAhm0U3zF1xcXOHuhjdU-lHJIjQsX8Nd0M",
        authDomain: "first-class-firebase.firebaseapp.com",
        projectId: "first-class-firebase",
        storageBucket: "first-class-firebase.appspot.com",
        messagingSenderId: "685476076997",
        appId: "1:685476076997:web:2ebc5ec00878085fac3fac",
        measurementId: "G-7ZP960H923",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      auth.languageCode = "it";

      function getPhoneNumberFromUserInput() {
        // Implementation to retrieve phone number from user input, such as an input field
        const phoneNumberInput = document.getElementById("phoneNumberInput");
        return phoneNumberInput.value;
      }

      function getCodeFromUserInput() {
        const codeInput = document.getElementById("codeInput");
        return codeInput.value;
      }

      const phoneNumber = getPhoneNumberFromUserInput();
      const appVerifier = window.recaptchaVerifier;
      const code = getCodeFromUserInput();

      window.recaptchaVerifier = new RecaptchaVerifier(
        auth,
        "sign-in-button",
        "recaptcha-container",
        {
          size: "invisible",
          callback: (response) => {
            // reCAPTCHA solved, allow signInWithPhoneNumber.
            onSignInSubmit();
          },
        }
      );

      window.recaptchaVerifier.render().then(function (widgetId) {
        grecaptcha.reset(widgetId);
      });

      signInWithPhoneNumber(auth, phoneNumber, appVerifier)
        .then((confirmationResult) => {
          // SMS sent. Prompt user to type the code from the message, then sign the
          // user in with confirmationResult.confirm(code).
          window.confirmationResult = confirmationResult;
          // ...
        })
        .catch((error) => {
          const errorCode = error.code;
          const errorMessage = error.message;
          // Error; SMS not sent
          // ...
        });

      const signP = () => {
        alert("I am Working");
        confirmationResult
          .confirm(code)
          .then((result) => {
            // User signed in successfully.
            const user = result.user;
            var credential = firebase.auth.PhoneAuthProvider.credential(
              confirmationResult.verificationId,
              code
            );
            firebase.auth().signInWithCredential(credential);
            // ...
          })
          .catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
            const credential = PhoneAuthProvider.credentialFromError(error);
            // User couldn't sign in (bad verification code?)
            // ...
          });
      };
      window.signP = signP;
    </script>
  </body>
</html>
